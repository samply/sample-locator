<div fxLayout="row" fxLayoutAlign="space-between stretch">
  <div fxFlex="1 0 0"></div>

  <div class="bbmri-container">
    <div fxLayout="row nowrap" fxLayoutAlign="space-between stretch">
      <div fxFlex="0 1 50%">
        <h2>Search</h2>

        <div *ngIf="!(mdrFieldProviderService.ready$ | async)">
          Waiting for data from Metadata Repository
          <p-progressBar mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar>
        </div>

        <!--suppress HtmlUnknownAttribute -->
        <app-search-builder headerName="Donor/Clinical Information"
                            disabled="true"
                            [mdrEntities]="mdrEntitiesDonor"></app-search-builder>
        <!--suppress HtmlUnknownAttribute -->
        <app-search-builder headerName="Sample"
                            disabled="true"
                            [mdrEntities]="mdrEntitiesSample"></app-search-builder>

        <div class="margin-action-buttons"
             fxLayout="row"
             fxLayoutAlign="end">
          <div fxLayout="row"
               fxLayout.lt-md="column-reverse"
               fxLayoutAlign="end"
               fxLayoutAlign.lt-md="start">
            <div class="samply-button samply-button-active"
                 fxLayout="row"
                 fxLayoutAlign="space-between"
                 (click)="resetQuery()">
              <fa-icon [icon]="faTimes" size="lg"></fa-icon>
              <div fxFlex="1 0 0"></div>
              <span>Clear</span>
            </div>

            <div class="samply-button samply-button-active"
                 fxLayout="row"
                 fxLayoutAlign="space-between"
                 (click)="editQuery()">
              <fa-icon [icon]="faEdit" size="lg"></fa-icon>
              <div fxFlex="1 0 0"></div>
              <span>Edit</span>
            </div>

            <div class="samply-button samply-button-inactive"
                 fxLayout="row"
                 fxLayoutAlign="space-between">
              <fa-icon [icon]="faPaperPlane" size="lg"></fa-icon>
              <div fxFlex="1 0 0"></div>
              <span>Send</span>
            </div>
          </div>
        </div>
      </div>

      <div fxFlex="0 0 1px" class="divider"></div>

      <div fxFlex="0 1 50%">
        <h2>Result</h2>

        <!-- SHOW SIMPLE RESULT -->
        <div class="result-extra-margin">
          <div class="result-item">
            <div fxLayout="row wrap" fxLayoutAlign="space-between"
                 fxLayout.lt-md="column" fxLayoutAlign.lt-md="start stretch">
              <div fxFlex="0 0 30%"
                   fxFlex.lt-md="0 0 100%"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Number of biobanks">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faBiobank" size="lg"></fa-icon>
                </div>
                <div fxFlex="0 0 70%" class="align-right">{{biobanksAnswered}}</div>
                <div fxFlex="0 0 10%"></div>
              </div>
              <div fxFlex="0 0 30%"
                   fxFlex.lt-md="0 0 100%"
                   fxLayout="row wrap"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Number of donors">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faDonor" size="lg"></fa-icon>
                </div>
                <div fxFlex="0 0 70%" class="align-right">{{sumDonors}}</div>
                <div fxFlex="0 0 10%"></div>
              </div>
              <div fxFlex="0 0 30%"
                   fxFlex.lt-md="0 0 100%"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Number of samples">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faSample" size="lg"></fa-icon>
                </div>
                <div fxFlex="0 0 70%" class="align-right">{{sumSamples}}</div>
                <div fxFlex="0 0 10%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- SHOW DETAILED RESULT -->
        <div *ngIf="userService.getLoginValid()">
          <div *ngIf="!isResultAnonymous()">
            <p-table [value]="detailedResult" [columns]="resultColumns">
              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th class="detailed-result-flag-header">
                    <fa-icon [icon]="faNegotiator" size="lg"></fa-icon>
                  </th>
                  <th *ngFor="let col of columns">
                    {{col.header}}
                  </th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-reply let-columns="columns">
                <tr>
                  <td (click)="toggleNegotiateFlag(reply.site)" class="detailed-result-flag-column">
                    <fa-icon [icon]="getNegotiateIcon(reply.site)" size="lg"></fa-icon>
                  </td>
                  <td *ngFor="let col of columns">
                    {{reply[col.field]}}
                  </td>
                </tr>
              </ng-template>
            </p-table>

            <div class="disclaimer">
              The result of your query represents only potentially available biosamples and data. Further information
              regarding access can be retrieved by direct communication with the respective biobanks activating the
              checkboxes and clicking the "Negotiate" button.
            </div>
          </div>
        </div>

        <div class="result-progressbar">
          <div *ngIf="showProcessingBar">
            <p-progressBar [value]="elapsedPercentage"
                           [showValue]="false"
                           [style]="{'height': '6px'}"></p-progressBar>
            Searching in {{limitBiobanksAnswered}} biobanks for 60 seconds...
          </div>

          <div class="disclaimer">
            <div *ngIf="!showProcessingBar">
              <div>
                Most results have been received after one minute.
                However, in some cases it might take up to five minutes for the last results to appear.
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!userService.getLoginValid()"
             fxLayout="row"
             fxLayoutAlign="center space-around"
             (click)="userService.login()"
             class="result-detail-button-wrapper">
          <span class="result-detail-button" fxFlex="0 0 auto">Show results per biobank</span>
        </div>

        <div *ngIf="userService.getLoginValid()"
             fxLayout="row" fxLayoutAlign="center">
          <div (click)="navigateToNegotiator()"
               [ngClass]="getNegotiatorButtonClass()">
            <fa-icon [icon]="faNegotiator" size="lg"></fa-icon>
            <span>Negotiate</span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div fxFlex="1 0 0"></div>
</div>
