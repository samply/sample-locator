<div fxLayout="row" fxLayoutAlign="space-between stretch">
  <div fxFlex="1 0 0"></div>

  <div class="bbmri-container">
    <div fxLayout="row nowrap" fxLayoutAlign="space-between stretch">
      <div fxFlex="0 1 50%">
        <h2>Search</h2>

        <div *ngIf="!(mdrFieldProviderService.ready$ | async)">
          Waiting for data from Metadata Repository
          <p-progressBar mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar>
        </div>

        <!--suppress HtmlUnknownAttribute -->
        <app-search-builder headerName="Donor/Clinical Information"
                            disabled="true"
                            [mdrEntities]="mdrEntitiesDonor"></app-search-builder>
        <!--suppress HtmlUnknownAttribute -->
        <app-search-builder headerName="Sample"
                            disabled="true"
                            [mdrEntities]="mdrEntitiesSample"></app-search-builder>

        <div class="margin-action-buttons"
             fxLayout="row"
             fxLayoutAlign="end">
          <div fxLayout="row"
               fxLayout.lt-md="column-reverse"
               fxLayoutAlign="end"
               fxLayoutAlign.lt-md="start">
            <app-samply-button [imageIcon]="faTimes" [active]="true" label="Clear" (click)="resetQuery()"></app-samply-button>
            <app-samply-button [imageIcon]="faEdit" [active]="true" label="Edit" (click)="editQuery()"></app-samply-button>
            <app-samply-button [imageIcon]="faPaperPlane" [active]="false" label="Send"></app-samply-button>
          </div>
        </div>
      </div>

      <div fxFlex="0 0 1px" class="divider"></div>

      <div fxFlex="0 1 50%">
        <h2>Result</h2>

        <!-- SHOW SIMPLE RESULT -->
        <div class="result-extra-margin">
          <div *ngIf="!userService.getLoginValid()"
               class="result-item">
            <div fxLayout="row wrap" fxLayoutAlign="center"
                 fxLayout.lt-md="column" fxLayoutAlign.lt-md="start stretch">
              <div fxFlex="0 0 33.3%"
                   fxFlex.lt-md="0 0 100%"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Number of biobanks">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faBiobank" size="lg"></fa-icon>
                </div>
                <div fxFlex="0 0 70%" class="align-right">{{biobanksAnswered}}</div>
                <div fxFlex="0 0 10%"></div>
              </div>
              <div fxFlex="0 0 33.3%"
                   fxFlex.lt-md="0 0 100%"
                   fxLayout="row wrap"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Number of donors">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faDonor" size="lg"></fa-icon>
                </div>
                <div fxFlex="0 0 70%" class="align-right">{{sumDonors}}</div>
                <div fxFlex="0 0 10%"></div>
              </div>
              <div fxFlex="0 0 33.3%"
                   fxFlex.lt-md="0 0 100%"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Number of samples">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faSample" size="lg"></fa-icon>
                </div>
                <div fxFlex="0 0 70%" class="align-right">{{sumSamples}}</div>
                <div fxFlex="0 0 10%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- SHOW DETAILED RESULT -->
        <div *ngIf="userService.getLoginValid()"
             class="no-transition">
          <div *ngIf="!isResultAnonymous()">
            <div fxLayout="row wrap" fxLayoutAlign="center"
                 fxLayout.lt-md="column" fxLayoutAlign.lt-md="start stretch">
              <!--suppress HtmlUnknownAttribute -->
              <div fxFlex="0 0 11%"
                   fxShow.lt-md="false"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Include in negotiation">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faNegotiator" size="lg"></fa-icon>
                </div>
              </div>
              <div fxFlex="0 0 30%"
                   fxFlex.lt-md="0 0 100%"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Number of biobanks">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faBiobank" size="lg"></fa-icon>
                </div>
                <div fxFlex="0 0 70%" class="align-right">{{biobanksAnswered}}</div>
                <div fxFlex="0 0 10%"></div>
              </div>
              <div fxFlex="0 0 29%"
                   fxFlex.lt-md="0 0 100%"
                   fxLayout="row wrap"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Number of donors">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faDonor" size="lg"></fa-icon>
                </div>
                <div fxFlex="0 0 70%" class="align-right">{{sumDonors}}</div>
                <div fxFlex="0 0 10%"></div>
              </div>
              <div fxFlex="0 0 30%"
                   fxFlex.lt-md="0 0 100%"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Number of samples">
                <div fxFlex="1 1 20%">
                  <fa-icon [icon]="faSample" size="lg"></fa-icon>
                </div>
                <div fxFlex="0 0 70%" class="align-right">{{sumSamples}}</div>
                <div fxFlex="0 0 10%"></div>
              </div>

              <div fxFlex="0 0 100%"
                   fxShow="false"
                   fxShow.lt-md="true"
                   class="small-table-margin-title">
              </div>
            </div>

            <div *ngFor="let reply of detailedResult"
                 fxLayout="row wrap" fxLayoutAlign="center"
                 fxLayout.lt-md="column" fxLayoutAlign.lt-md="start stretch">
              <div fxFlex="0 0 100%"
                   fxShow="false"
                   fxShow.lt-md="true"
                   class="small-table-margin">
              </div>
              <!--suppress HtmlUnknownAttribute -->
              <div fxFlex="0 0 11%"
                   fxShow.lt-md="false"
                   class="result-table-row"
                   tooltipPosition="bottom"
                   pTooltip="Include in negotiation">
                <div fxFlex="1 1 20%" (click)="toggleNegotiateFlag(reply.site)">
                  <fa-icon [icon]="getNegotiateIcon(reply.site)" size="lg"></fa-icon>
                </div>
              </div>
              <div fxFlex="0 0 30%"
                   fxFlex.lt-md="0 0 100%"
                   class="result-table-row">
                <div fxShow="true"
                     fxShow.lt-md="false">
                  {{reply['site']}}
                </div>
                <div fxShow="false"
                     fxShow.lt-md="true"
                     fxLayoutAlign="space-between">
                  <div fxFlex="1 0 75%">{{reply['site']}}</div>
                  <div fxFlex="1 0 10%"
                       (click)="toggleNegotiateFlag(reply.site)">
                    <fa-icon [icon]="faNegotiator" size="lg"></fa-icon>
                  </div>
                  <div fxFlex="1 0 10%"
                       (click)="toggleNegotiateFlag(reply.site)">
                    <fa-icon [icon]="getNegotiateIcon(reply.site)" size="lg"></fa-icon>
                  </div>
                  <div fxFlex="1 0 5%"
                       (click)="toggleNegotiateFlag(reply.site)">
                  </div>
                </div>
              </div>
              <div fxFlex="0 0 29%"
                   fxFlex.lt-md="0 0 100%"
                   class="result-table-row"
                   fxLayout="row"
                   fxLayoutAlign="start">
                <div fxFlex="0 0 90%" class="align-right">{{reply['donor']}}</div>
              </div>
              <div fxFlex="0 0 30%"
                   fxFlex.lt-md="0 0 100%"
                   class="result-table-row"
                   fxLayout="row"
                   fxLayoutAlign="start">
                <div fxFlex="0 0 90%" class="align-right">{{reply['sample']}}</div>
              </div>
            </div>

            <div class="disclaimer">
              The result of your query represents only potentially available biosamples and data. Further information
              regarding access can be retrieved by direct communication with the respective biobanks activating the
              checkboxes and clicking the "Negotiate" button.
            </div>
          </div>
        </div>

        <div class="result-progressbar">
          <div *ngIf="showProcessingBar">
            <p-progressBar [value]="elapsedPercentage"
                           [showValue]="false"
                           [style]="{'height': '6px'}"></p-progressBar>
            Searching in {{limitBiobanksAnswered}} biobanks for 60 seconds...
          </div>

          <div class="disclaimer">
            <div *ngIf="!showProcessingBar">
              <div>
                Most results have been received after one minute.
                However, in some cases it might take up to five minutes for the last results to appear.
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!userService.getLoginValid()"
             fxLayout="row"
             fxLayoutAlign="center space-around"
             (click)="userService.login()"
             class="result-detail-button-wrapper">
          <span class="result-detail-button" fxFlex="0 0 auto">Show results per biobank</span>
        </div>

        <div *ngIf="userService.getLoginValid()"
             fxLayout="row" fxLayoutAlign="center">
          <div (click)="navigateToNegotiator()"
               [ngClass]="getNegotiatorButtonClass()">
            <fa-icon [icon]="faNegotiator" size="lg"></fa-icon>
            <span>Negotiate</span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div fxFlex="1 0 0"></div>
</div>
